<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Posts | yoan.log</title><meta name=keywords content><meta name=description content="Posts - yoan.log"><meta name=author content="motoki yoan"><link rel=canonical href=https://myoan.github.io/posts/><link crossorigin=anonymous href=/assets/css/stylesheet.343cc480b9ffc8f04ccbe5e968ad674880cab773ec19905e93033065c1e7a804.css integrity="sha256-NDzEgLn/yPBMy+XpaK1nSIDKt3PsGZBekwMwZcHnqAQ=" rel="preload stylesheet" as=style><link rel=icon href=https://myoan.github.io/%3Clink%20/static/favicon.ico%3E><link rel=icon type=image/png sizes=16x16 href=https://myoan.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://myoan.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://myoan.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://myoan.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate type=application/rss+xml href=https://myoan.github.io/posts/index.xml title=rss><link rel=alternate hreflang=en href=https://myoan.github.io/posts/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://myoan.github.io/posts/"><meta property="og:site_name" content="yoan.log"><meta property="og:title" content="Posts"><meta property="og:description" content="blooooooooooooog"><meta property="og:locale" content="en"><meta property="og:type" content="website"><meta property="og:image" content="https://myoan.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://myoan.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Posts"><meta name=twitter:description content="blooooooooooooog"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://myoan.github.io/posts/"}]}</script></head><body class=list id=top><header class=header><nav class=nav><div class=logo><a href=https://myoan.github.io/ accesskey=h title="yoan.log (Alt + H)">yoan.log</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://myoan.github.io/categories/ title=categories><span>categories</span></a></li><li><a href=https://myoan.github.io/tags/ title=tags><span>tags</span></a></li></ul></nav></header><main class=main><header class=page-header><div class=breadcrumbs><a href=https://myoan.github.io/>Home</a></div><h1>Posts</h1></header><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>40目前、首に真綿を感じる日々</h2></header><div class=entry-content><p>これは 趣 Advent Calendar の12日目の記事です。 2025年もお疲れ様でした。 私自身の2025年について振り返りたいと思います。
自分時間を有効活用できない 2025年は激動の年でした。転職、子供の転園などイベントが目白押しでした。
新しい仕事、家事育児。自分の時間と呼べるものは寝る前の2時間と休日に子供が昼寝をする2時間程度しかありません。 週18時間。これが私に残された時間です。 その18時間も子供が病気で早退したとなると勤務時間を補うことに使われます。
懺悔すると、この貴重な時間をまったく有用に使えていません。 仕事と育児に疲れ、脳が考えることを拒否し個人開発は止まり読書も目が滑ります。 結果、YouTubeでお気に入りのチャンネルを見て時間を溶かしています。
あぁ、ミドルエイジクライシス すると久しぶりに友人や同僚と会っても会話が生まれません。 趣味は細分化し共通の話題がなく、新しい技術を追っていないため話題提供できません。 そうなると口から出るのは伝家の宝刀「健康」「育児」「投資」です。
飲みの場は楽しいですが、帰りの電車ではその話題を思い出して身も心もおじさんになってしまったことに虚しさを感じます。
でも幸せです 妻と子供の3人で歩いているとき急に俯瞰した目線になり「ああ、これが幸せなんだ」と感じました。 35歳を過ぎて郊外にマンションを購入し、休日は家族で車で30分のショッピングモールに行く。 自我が芽生え始めた子供に手を焼きつつ、子供が寝た瞬間を見計らって妻とスイーツを食べる。 恵まれているとしか言いようがない状況です。
LLMの衝撃 話は変わりますが、今年は猫も杓子もLLMの年でしたね。 私もその片鱗に触れて老後まで自身の市場価値が維持できなくなる、タイムリミットが早まっていると感じます。 今のところ成果物に責任持てる範囲内でLLM利用することでうまく付き合えてると思います。 この「成果物に対する責任」が人に帰属している間は食べていけそうですが、責任すら持てなくなると終わるように思います。
ここまでのまとめ 2025年の私の心理的状況をまとめると以下のようになります。
家族と過ごし子供の成長を日々感じられる幸福感 一方で、仕事と家事育児に追われ自己投資できないことへの焦燥 LLMの台頭により自身の市場価値の低下が想像以上に早くなることへの不安 2025年はこの真綿が首に巻き付いてることにようやく気づけた1年であったように思えます。
LLMが生成できないトークン LLMは確率計算上次にでるトークンを予測して文章を生成しているらしいです。 世間の大多数に流れていった人間はLLMに代替されやすいと思うのです。
今まで私は効率的に学習することを念頭に置いて、名著と言われる本を読み、メインストリームにある技術を中心に触れてきました。 このような本や技術は他の方による解説も多くLLMに聞いてもある程度精度の高い結果を返してくれるでしょう。 どうやら今の私はLLMに代替されやすい立ち位置にいるようです。
でも逆にLLMがまだ提示できないニッチな情報を持っていれば、もしかしたら酒のツマミ程度には話を聞いてくれるかもしれません。
生の情報を蒸留する なるべく他人の思考が介在する情報を避け、自分で生の情報を取得し内面化する。 そのような訓練をしていく必要がありそうです。 もちろん深堀りする努力が足りないと言われたらそれまでです。というか足りないんだと思います。
40までの2年間 これから40まであと2年あります。
私には週18時間しかありません。この中で全ての生の情報を取ることはできません。 そこでジャンルをしぼり、そのジャンルに対しては他人の思考がなるべく介在していない情報を自主的に摂取しようと思います。 この18時間もなるべく質を上げる必要があります。 YouTubeともうまく付き合えるように仕組みづくりをしていく必要がありそうです。 18時間を拡張する方向でもいくつか試してみたいです。 誰も知らないニッチな話題を提供できるようになったら、きっと飲み会の帰りも楽しくなると思います。
それでは来年もよろしくお願いします。</p></div><footer class=entry-footer><span title='2025-12-24 09:03:32 +0900 +0900'>December 24, 2025</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>motoki yoan</span></footer><a class=entry-link aria-label="post link to 40目前、首に真綿を感じる日々" href=https://myoan.github.io/posts/omomuki/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Git Submodule系操作まとめ</h2></header><div class=entry-content><p>git submoduleのコマンドをよく調べるのでまとめてしまう
https://git-scm.com/book/ja/v2/Git-%E3%81%AE%E3%81%95%E3%81%BE%E3%81%96%E3%81%BE%E3%81%AA%E3%83%84%E3%83%BC%E3%83%AB-%E3%82%B5%E3%83%96%E3%83%A2%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB
を参考にしています
1. 初期化する git submodule init 2. 更新する git submodule update 1, 2を合わせて
git submodule update --init 3. diffが意味不明 yoan $ git diff diff --git a/submodule b/submodule index aaaaaaaaaa..bbbbbbbb 160000 --- a/submodule +++ b/submodule @@ -1 +1 @@ -Subproject commit aaaaaaa... +Subproject commit bbbbbbb... diff差分がよくわからないときは--submoduleオプションを追加する
yoan $ git diff --submodule Submodule /submodule aaaaaaaaaaa..bbbbbbbbbbb (rewind): &lt; Merge pull request #2 from hogehoge defaultで有効化もできる
yoan $ git config --global diff.submodule log 4. 間違ったcommitになってしまう この記事を書こうと思った本命。 3の例でdiffに(rewind)が出ている (rewindは巻き戻りという意味) 実際、originではaaaaaaaaaaaが最新なのになぜかlocalでは一つ前のbbbbbbbbbbに変えようとしている この状態が何故起こったのかはよくわからないがsubmodule updateをしても無駄だった
...</p></div><footer class=entry-footer><span title='2023-03-23 19:43:32 +0900 +0900'>March 23, 2023</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>motoki yoan</span></footer><a class=entry-link aria-label="post link to Git Submodule系操作まとめ" href=https://myoan.github.io/posts/git-submodule-update/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Ansible</h2></header><div class=entry-content><p>ansibleの使い方 install brew install ansible 接続確認 ❯ cat hosts [server] xxx.xxx.xxx.xxx 実行
❯ ansible server -i hosts -m ping -u ubuntu 18.183.206.58 | SUCCESS => { "ansible_facts": { "discovered_interpreter_python": "/usr/bin/python3" }, "changed": false, "ping": "pong" } playbook適用 ❯ cat playbook.yml --- - name: Update web servers hosts: server remote_user: ubuntu become: true tasks: - name: Run the equivalent of "apt-get update" as a separate step ansible.builtin.apt: update_cache: yes syntax-check ansible-playbook playbook.yml --syntax-check dryrun ansible-playbook playbook.yml -i hosts -C -D 適用 ansible-playbook playbook.yml -i hosts playbookの探し方 https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_module.html
...</p></div><footer class=entry-footer><span title='2022-07-12 02:56:03 +0900 +0900'>July 12, 2022</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>motoki yoan</span></footer><a class=entry-link aria-label="post link to Ansible" href=https://myoan.github.io/posts/ansible/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Journalctl の使い方</h2></header><div class=entry-content><p>忙しい人向け journalctl -u mariadb.service -xe serviceを指定する journalctl -u mariadb.service tailする journalctl -e tail -f journalctl -f 詳細情報 journalctl -xe</p></div><footer class=entry-footer><span title='2022-07-10 23:53:52 +0900 +0900'>July 10, 2022</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>motoki yoan</span></footer><a class=entry-link aria-label="post link to Journalctl の使い方" href=https://myoan.github.io/posts/journalctl/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Multiplayer Game Programming読本</h2></header><div class=entry-content><p>multiplayer game programmingという本を気になる部分だけつまみ食いして読んでいる 今日はChapter 4にあった"Compression"をまとめる 英語の見出しは本文のタイトルを引用し、日本語の見出しは私がみやすさでつけたもの
Compression マルチプレイのリアルタイム性のあるゲームであればあるほど、通信するオブジェクトと頻度が増え必要な通信帯域が増加する そのため、可能な限り無駄な情報は削減して通信を行う必要がある この章では低レベルな圧縮方法の紹介を行っている
Sparse Array Compression 本で扱っているサンプルゲームでは名前を128byteまで許容されている。 名前の配列に128byteの配列を利用するのがプログラムとしては妥当だが、128byte使い切らないユーザーも含まれるため不要なスペースができてしまう。 そこで、名前長 + 名前というバイト列にする事で余計なスペースを除去するという圧縮方法
Entropy Encoding 以下の章ではオブジェクトの方向と回転を表す7つのfloatの圧縮方法について記載されている 参考書ではbyte配列を渡す想定をしているが、理解を助けるために下記のような構造体の形式で書いていく
// 合計 28byte type XXX struct { type Location struct { x float y float z float } type Quartunion struct { qx float qy float qz float qw float } } 頻出する状態には短いデータを与えましょう。という内容 サンプルゲームではキャラがほとんどY=0のポジションにいる特性を利用してY=0ならばtrue, そうでなければfalse+floatの情報を送っている
// 合計 24byte + 1bit type XXX struct { type Location struct { x float ybit bool y float z float } type Quartunion struct { qx float qy float qz float qw float } } Fixed point Locationの他の2軸の圧縮をする この内容はゲームの特性と相談になるが、整数値にすることでサイズを減らそうというもの 本では縦横に40000(おそらくpx)が表現できれば良いため、int16でよいという内容だった
...</p></div><footer class=entry-footer><span title='2022-05-11 10:00:42 +0900 +0900'>May 11, 2022</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>motoki yoan</span></footer><a class=entry-link aria-label="post link to Multiplayer Game Programming読本" href=https://myoan.github.io/posts/geometry-compression/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>GKEからのGCPへの認証をまとめる</h2></header><div class=entry-content><p>GKE cluster作成時にも指定できるアクセススコープはレガシー扱いになっている https://cloud.google.com/kubernetes-engine/docs/how-to/access-scopes#what_are_access_scopes
とはいえチュートリアルには--scopeを利用したものも見受けられる
https://agones.dev/site/docs/installation/creating-cluster/gke/ アクセススコープは手軽だが細かい設定ができない。ServiceAccountを使うと必要最低限の権限のみ付与する事ができるので、セキュリティの品質が保たれるためGoogleとしてはServiceAccountを推している。という認識でいいのかな.
GKEの権限関係で迷わないよう、サービス アカウントを使用した Google Cloud への認証を題材にやり方を整理する
アクセススコープを用いた認証 ServiceAccountを用いた認証 (おまけ) ServiceAccount認証にWorkload Identityを用いる 事前準備 題材に則りpubsub topicを作成し、publishとsubscribeができるか検証する
pubsub topicの作成 gcloud pubsub topics create echo gcloud pubsub subscriptions create echo-read --topic=echo ソースコード取得 git clone https://github.com/GoogleCloudPlatform/kubernetes-engine-samples cd kubernetes-engine-samples cloud-pubsub/deployment以下のyamlファイルを実際に適応していく
1. アクセススコープを用いた認証 クラスタ作成
gcloud container clusters create pubsub-test --scopes=gke-default,https://www.googleapis.com/auth/pubsub --zone asia-northeast1-a scope オプションについて --scopesオプションをつけることでクラスタに権限を付与できる gke-defaultは下記のscopeをまとめたエイリアスになる
Alias URI gke-default https://www.googleapis.com/auth/devstorage.read_only https://www.googleapis.com/auth/logging.write https://www.googleapis.com/auth/monitoring https://www.googleapis.com/auth/service.management.readonly https://www.googleapis.com/auth/servicecontrol https://www.googleapis.com/auth/trace.append gcloud container clusters create --helpをすると他のエイリアスもあるのでみてみると良い (webのmanにも載っている)
また複数指定したいのでカンマ区切りで指定している scopeの一覧から選んで付与していく.
(権限を追加する) 後から権限を追加したくなるケースはどうするか? scopeを変えたいならば、node-poolsを作り変える事しかできない
# 新規作成 gcloud container node-pools create new-pools --cluster pubsub-test --scopes=gke-default,https://www.googleapis.com/auth/pubsub,https://www.googleapis.com/auth/something # 古いnodeを削除 gcloud container node-pools delete old-pools --cluster pubsub-test デプロイ kubectl apply -f cloud-pubsub/deployment/pubsub.yaml kubectl get po NAME READY STATUS RESTARTS AGE pubsub-8cb8475c8-tvxwv 1/1 Running 0 95s 確認 Publish gcloud pubsub topics publish echo --message="Hello, world\!" messageIds: - '3909513331830980' Subscribe kubectl logs -f pubsub-8cb8475c8-tvxwv Pulling messages from Pub/Sub subscription... [2022-03-21 06:37:27.265195] Received message: ID=3909513331830980 Data=b'Hello, world!' [2022-03-21 06:37:27.265294] Processing: 3909513331830980 [2022-03-21 06:37:30.267957] Processed: 3909513331830980 2. ServiceAccountを用いた認証 Googleが推奨しているのはこちら サービス アカウントを使用した Google Cloud への認証と同じ事をしているだけなので説明は省く
...</p></div><footer class=entry-footer><span title='2022-03-21 11:19:25 +0900 +0900'>March 21, 2022</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;·&nbsp;<span>motoki yoan</span></footer><a class=entry-link aria-label="post link to GKEからのGCPへの認証をまとめる" href=https://myoan.github.io/posts/gke-gcp-auth/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>coreutilsのソースコードをDLする方法</h2></header><div class=entry-content><p>aspのinstall $ sudo pacman asp aspの簡単な使い方 # packageの一覧 $ asp list-all # packageの取得 $ asp checkout coreutils coreutilsのダウンロード $ asp checokut coreutils $ cd coreutils $ makepkg -o # buildはせずDLだけするオプション 詰まったところ GPGキーがverifiyされない makepkgの実行中で下記のようなエラーが発生した
-> Found 01-fix-fs72253.patch ==> Validating source files with sha256sums... coreutils-9.0.tar.xz ... Passed coreutils-9.0.tar.xz.sig ... Skipped 01-fix-fs72253.patch ... Passed ==> Verifying source file signatures with gpg... coreutils-9.0.tar.xz ... FAILED (unknown public key DF6FD971306037D9) ==> ERROR: One or more PGP signatures could not be verified! GNUのページに書いてあるコマンドを実行する
...</p></div><footer class=entry-footer><span title='2021-12-11 18:04:58 +0900 +0900'>December 11, 2021</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>motoki yoan</span></footer><a class=entry-link aria-label="post link to coreutilsのソースコードをDLする方法" href=https://myoan.github.io/posts/read-coreutils/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>Kotest Listener</h2></header><div class=entry-content><p>kotest kotlinでテストFWを増やしている
Listenerの確認 TestListener
beforeAnyとbeforeTest, afterAnyとafterTestは同じらしいので一つにまとめます
import io.kotest.core.spec.style.DescribeSpec import io.kotest.matchers.shouldBe class ListenerSpec: DescribeSpec({ describe("listener hook check") { beforeContainer { println("beforeContainer") } afterContainer { println("afterContainer") } beforeEach { println("beforeEach") } afterEach { println("afterEach") } beforeTest { println("beforeAny/beforeTest") } afterTest { println("afterAny/afterTest") } beforeSpec { println("beforeSpec") } afterSpec { println("afterSpec") } context("Simple") { it("Simple test") { println("--- Simple test") 1 shouldBe 1 } } } }) beforeContainer beforeAny/beforeTest beforeEach beforeAny/beforeTest --- Simple test afterEach afterAny/afterTest afterContainer afterAny/afterTest afterSpec before, afterともにContainer > Any/Test, Each > Any/Testの流れになっている beforeとafterでstackの様にコールされるわけではない beforeSpecが呼び出されない 詳細を調べる class ListenerSpec: DescribeSpec({ // ... describe("listener hook check") { describe("Describe") { it("Simple test") { println("--- Simple test") 1 shouldBe 1 } } } }) beforeContainer beforeAny/beforeTest beforeEach beforeAny/beforeTest --- Simple test afterEach afterAny/afterTest afterContainer afterAny/afterTest afterSpec Listener順序において、describeとcontextの差異は見られない class ListenerSpec: DescribeSpec({ describe("listener hook check") { describe("Describe") { it("List 1 test") { println("--- List-1 test") 1 shouldBe 1 } it("List 2 test") { println("--- List-2 test") 1 shouldBe 1 } } } }) beforeContainer beforeAny/beforeTest beforeEach beforeAny/beforeTest --- List-1 test afterEach afterAny/afterTest beforeEach beforeAny/beforeTest --- List-2 test afterEach afterAny/afterTest afterContainer afterAny/afterTest afterSpec Containerが消えた class ListenerSpec: DescribeSpec({ // ... describe("listener hook check") { describe("Describe") { context("Context") { it("Simple test") { println("--- Simple test") 1 shouldBe 1 } } } } }) beforeContainer beforeAny beforeTest beforeContainer beforeAny beforeTest beforeEach beforeAny beforeTest --- Simple test afterEach afterAny afterTest afterContainer afterAny afterTest afterContainer afterAny afterTest afterSpec nestするとcontainer, any, testが追加される class ListenerSpec: DescribeSpec({ describe("listener hook check") { describe("Describe") { describe("Describe") { it("Simple test") { println("--- Simple test") 1 shouldBe 1 } } } } }) beforeContainer beforeAny beforeTest beforeContainer beforeAny beforeTest beforeEach beforeAny beforeTest --- Simple test afterEach afterAny afterTest afterContainer afterAny afterTest afterContainer afterAny afterTest afterSpec</p></div><footer class=entry-footer><span title='2021-06-04 12:09:52 +0900 +0900'>June 4, 2021</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>motoki yoan</span></footer><a class=entry-link aria-label="post link to Kotest Listener" href=https://myoan.github.io/posts/kotest-listener/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>vscode extensionのTreeViewを触ってみる</h2></header><div class=entry-content><p>チュートリアルを行う https://code.visualstudio.com/api/extension-guides/tree-view
チュートリアルではサイドバーにnode dependenciesを表示し、各packageのpackage.jsonを表示するサンプルを作っている。 しかしチュートリアルをそのまま試してもEditorにpackage.jsonの内容が表示されなかった。
その理由が知りたくて色々と調査した
結果として、githubのサンプルを実行するとわかるが、クリック時に発火するコマンドを指定しないと行けなかった
コマンド発火のコードリーディング TreeViewをみると、チュートリアルに加えてvscode.Commandを付与している
return new Dependency(moduleName, version, vscode.TreeItemCollapsibleState.None, { command: 'extension.openPackageOnNpm', title: '', arguments: [moduleName] }); 併せてopenPackageOnNpmの登録もチュートリアルから追加されている
vscode.commands.registerCommand('extension.openPackageOnNpm', moduleName => vscode.commands.executeCommand('vscode.open', vscode.Uri.parse(`https://www.npmjs.com/package/${moduleName}`))); 実際、これらを実装するとクリックしたらNPMのwebpageに飛ぶ挙動が確認できた
TreeItemオブジェクトはcommandをフィールドに保存しているが、自クラスでフィールドを操作している形跡はない つまり、vscode本体でTreeItem.commandを呼び出していると考えられる
vscode本体をコードリーディング TreeItemの定義はこちら command自体は存在している よって、vscode本体でTreeItem.commandを呼び出す仮説は正しそう
https://github.com/microsoft/vscode/blob/main/src/vs/vscode.d.ts#L9136
この説明を見るに、clickをフックしてcommandを呼んでいる模様。
async resolveTreeItem(treeItemHandle: string, token: vscode.CancellationToken): Promise&lt;ITreeItem | undefined> { if (!this.dataProvider.resolveTreeItem) { return; } const element = this.elements.get(treeItemHandle); if (element) { const node = this.nodes.get(element); if (node) { const resolve = await this.dataProvider.resolveTreeItem(node.extensionItem, element, token) ?? node.extensionItem; // Resolvable elements. Currently only tooltip and command. node.item.tooltip = this.getTooltip(resolve.tooltip); node.item.command = this.getCommand(node.disposableStore, resolve.command); return node.item; } } return; } https://github.com/microsoft/vscode/blob/8aff878db2542eea2dfb571c8bb485118bbb3113/src/vs/workbench/api/common/extHostTreeViews.ts#L376-L392
TreeItemを取得するときにクリックハンドラをgetCommandで取得していた</p></div><footer class=entry-footer><span title='2021-04-19 09:07:06 +0900 +0900'>April 19, 2021</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>motoki yoan</span></footer><a class=entry-link aria-label="post link to vscode extensionのTreeViewを触ってみる" href=https://myoan.github.io/posts/vscode-tree-view/></a></article><article class=post-entry><header class=entry-header><h2 class=entry-hint-parent>go getで取得したコマンドの名前を変更する</h2></header><div class=entry-content><p>yeomanを入れて実行したところエラー
❯ yo code must specify 3 arguments 確認したところspannerのgeneratorであるyoがすでに入っていました…
❯ yo help yo is a command-line tool to generate Go code for Google Cloud Spanner. (混乱を避けるため、以降ではコードブロック以外yoはspannerのコードジェネレートツールを指します)
両方利用したかったのでspanner generatorのyoを別名に書き換える方針で決めました。 その名もgoyoです(ババーン)
本題 ではどうやったらgo getで取得したコマンド名を変えられるのか？
go getのオプションを探しましたがありませんでした
そこで仕方なくyoの名前自体を変更します
yoはバイナリが入っていると思ったらシェルスクリプトでした (goenvを使っているとそうなる？)
❯ file ~/.anyenv/envs/goenv/shims/yo /Users/motoki.yoan/.anyenv/envs/goenv/shims/yo: Bourne-Again shell script text executable, ASCII text ❯ cat ~/.anyenv/envs/goenv/shims/yo #!/usr/bin/env bash set -e [ -n "$GOENV_DEBUG" ] && set -x program="${0##*/}" if [[ "$program" = "go"* ]]; then for arg; do case "$arg" in -c* | -- ) break ;; */* ) if [ -f "$arg" ]; then export GOENV_FILE_ARG="$arg" break fi ;; esac done fi export GOENV_ROOT="/Users/me/.anyenv/envs/goenv" exec "/Users/me/.anyenv/envs/goenv/libexec/goenv" exec "$program" "$@" programがyoを表しているように見えますが、##*/が意味不明です
...</p></div><footer class=entry-footer><span title='2021-02-06 16:25:03 +0900 +0900'>February 6, 2021</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>motoki yoan</span></footer><a class=entry-link aria-label="post link to go getで取得したコマンドの名前を変更する" href=https://myoan.github.io/posts/duplicate-command/></a></article><footer class=page-footer><nav class=pagination><a class=next href=https://myoan.github.io/posts/page/2/>Next&nbsp;&nbsp;»</a></nav></footer></main><footer class=footer><span>&copy; 2025 <a href=https://myoan.github.io/>yoan.log</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script></body></html>